"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[723],{99017:function(Rn,te,o){o.r(te),o.d(te,{default:function(){return xn}});var ve=o(5574),E=o.n(ve),w=o(67294),pe=o(64599),Ce=o.n(pe),je=o(15009),A=o.n(je),xe=o(19632),X=o.n(xe),ye=o(97857),f=o.n(ye),Ze=o(99289),H=o.n(Ze),Fe=o(12444),ae=o.n(Fe),De=o(72004),re=o.n(De),be=o(25098),j=o.n(be),Me=o(31996),Ee=o.n(Me),Re=o(26037),Le=o.n(Re),Se=o(9783),h=o.n(Se),D=o(74250),we=o(99477),Ue=o(69365),Te=o(87312),Ae=o(24755),Y=o(25409),N=o(78957),Oe=o(54397),k=o(84673),K=o(2453),Pe=o(88484),Ie=o(48483),Je=o(30881),n=o(85893),ze=Oe.Z.Dragger,V=k.Z.Text,Be=k.Z.Paragraph,Ne=function(v){var g=v.onChange,p=(0,w.useRef)(new Map),e=function(){var r=H()(A()().mark(function t(i){var l,s,d,c;return A()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:l=i.file,s=i.onSuccess;try{l.name.endsWith(".urdf")?(c={id:"robot-".concat(Date.now()),name:l.name,file:l},g([c],p.current)):(d=l.webkitRelativePath)!==null&&d!==void 0&&d.includes("meshes/")&&p.current.set(l.name,l),s==null||s("ok")}catch(Z){K.ZP.error("\u6587\u4EF6\u5904\u7406\u5931\u8D25: ".concat(Z.message))}case 2:case"end":return m.stop()}},t)}));return function(i){return r.apply(this,arguments)}}(),a={name:"file",multiple:!0,customRequest:e,showUploadList:!1,directory:!0,beforeUpload:function(t){var i=t.name.toLowerCase().split(".").pop();return["urdf","dae","stl"].includes(i)},onChange:function(t){if(t.file.status==="done"){var i=t.fileList.filter(function(l){return l.name.toLowerCase().endsWith(".urdf")}).map(function(l){return{id:"robot-".concat(Date.now()),name:l.name,file:l.originFileObj}});i.length>0&&g(i,p.current)}}};return(0,n.jsx)("div",{children:(0,n.jsxs)(ze,f()(f()({},a),{},{className:"custom-upload-dragger",style:{padding:4},children:[(0,n.jsx)("p",{className:"ant-upload-drag-icon",children:(0,n.jsx)(Pe.Z,{})}),(0,n.jsx)(V,{strong:!0,children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u5939\u5230\u6B64\u533A\u57DF"}),(0,n.jsxs)(Be,{type:"secondary",style:{marginTop:12},children:[(0,n.jsx)(V,{strong:!0,children:"\u6587\u4EF6\u5939\u7ED3\u6784\u793A\u4F8B\uFF1A"}),(0,n.jsx)("pre",{style:{padding:"8px",borderRadius:"4px",marginTop:"8px",fontSize:"12px"},children:`your_model/
  \u251C\u2500\u2500 urdf/
           \u2502   \u2514\u2500\u2500 robot.urdf
    \u2514\u2500\u2500 meshes/
               \u251C\u2500\u2500 link1.dae
               \u251C\u2500\u2500 link2.stl
         \u2514\u2500\u2500 ...`}),(0,n.jsx)(V,{strong:!0,children:"URDF\u6587\u4EF6\u4E2D\u7684\u8DEF\u5F84\u5F15\u7528\uFF1A"}),(0,n.jsxs)("div",{style:{marginTop:8,display:"flex",alignItems:"center"},children:[(0,n.jsx)(Ie.Z,{twoToneColor:"#52c41a"}),(0,n.jsx)(V,{style:{marginLeft:8},children:"\u2002../meshes/part1.dae"})]}),(0,n.jsxs)("div",{style:{marginTop:4,display:"flex",alignItems:"center"},children:[(0,n.jsx)(Je.Z,{twoToneColor:"#eb2f96"}),(0,n.jsx)(V,{style:{marginLeft:8},children:"\u2002package://your_model/meshes/part1.dae"})]})]})]}))})},ke=Ne,P=o(71230),C=o(15746),L=o(83622),Ve=o(96074),I=o(86125),Ge=o(86547),Q=o(72269),He=o(83062),We=o(85265),ie=o(88916),Xe=o(87603),Ye=o(1912),Ke=o(62635),Qe=o(82826),$e=o(77171),qe=o(66017),_e=o(64576),en=o(69980),nn=o(42952),W=k.Z.Title,tn=function(v){var g=v.config,p=v.onConfigChange,e=v.onViewChange,a=(0,w.useState)(!1),r=E()(a,2),t=r[0],i=r[1],l=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{style:{marginBottom:16},children:[(0,n.jsxs)(W,{level:5,children:[(0,n.jsx)(ie.Z,{})," \u89C6\u89D2\u63A7\u5236"]}),(0,n.jsxs)(P.Z,{gutter:[8,8],children:[(0,n.jsx)(C.Z,{span:8,children:(0,n.jsx)(L.ZP,{icon:(0,n.jsx)(Xe.Z,{}),onClick:function(){return e("+x")},title:"+X\u8F74\u89C6\u56FE",block:!0,color:"primary",variant:"filled",children:"+X"})}),(0,n.jsx)(C.Z,{span:8,children:(0,n.jsx)(L.ZP,{icon:(0,n.jsx)(Ye.Z,{}),onClick:function(){return e("+y")},title:"+Y\u8F74\u89C6\u56FE",block:!0,color:"primary",variant:"filled",children:"+Y"})}),(0,n.jsx)(C.Z,{span:8,children:(0,n.jsx)(L.ZP,{icon:(0,n.jsx)(Ke.Z,{}),onClick:function(){return e("+z")},title:"+Z\u8F74\u89C6\u56FE",block:!0,color:"primary",variant:"filled",children:"+Z"})}),(0,n.jsx)(C.Z,{span:8,children:(0,n.jsx)(L.ZP,{icon:(0,n.jsx)(Qe.Z,{}),onClick:function(){return e("-x")},title:"-X\u8F74\u89C6\u56FE",block:!0,color:"primary",variant:"filled",children:"- X"})}),(0,n.jsx)(C.Z,{span:8,children:(0,n.jsx)(L.ZP,{icon:(0,n.jsx)($e.Z,{}),onClick:function(){return e("-y")},title:"-Y\u8F74\u89C6\u56FE",block:!0,color:"primary",variant:"filled",children:"- Y"})}),(0,n.jsx)(C.Z,{span:8,children:(0,n.jsx)(L.ZP,{icon:(0,n.jsx)(qe.Z,{}),onClick:function(){return e("-z")},title:"-Z\u8F74\u89C6\u56FE",block:!0,color:"primary",variant:"filled",children:"- Z"})})]})]}),(0,n.jsx)(Ve.Z,{style:{margin:"16px 0"}}),(0,n.jsxs)("div",{style:{marginBottom:16},children:[(0,n.jsxs)(W,{level:5,children:[(0,n.jsx)(ie.Z,{})," \u76F8\u673A\u53C2\u6570"]}),(0,n.jsxs)(P.Z,{align:"middle",gutter:[16,8],children:[(0,n.jsx)(C.Z,{span:8,children:"\u89C6\u91CE\u89D2\u5EA6(FOV)"}),(0,n.jsx)(C.Z,{span:16,children:(0,n.jsx)(I.Z,{min:30,max:120,value:g.fov,onChange:function(d){return p("fov",d)}})}),(0,n.jsx)(C.Z,{span:8,children:"\u76F8\u673A\u8DDD\u79BB"}),(0,n.jsx)(C.Z,{span:16,children:(0,n.jsx)(I.Z,{min:1,max:20,step:.1,value:g.cameraDistance,onChange:function(d){return p("cameraDistance",d)}})})]})]}),(0,n.jsxs)("div",{style:{marginBottom:16},children:[(0,n.jsxs)(W,{level:5,children:[(0,n.jsx)(_e.Z,{})," \u5149\u7167\u8BBE\u7F6E"]}),(0,n.jsxs)(P.Z,{align:"middle",gutter:[16,8],children:[(0,n.jsx)(C.Z,{span:8,children:"\u73AF\u5883\u5149\u5F3A\u5EA6"}),(0,n.jsx)(C.Z,{span:16,children:(0,n.jsx)(I.Z,{min:0,max:1,step:.1,value:g.ambientIntensity,onChange:function(d){return p("ambientIntensity",d)}})}),(0,n.jsx)(C.Z,{span:8,children:"\u5E73\u884C\u5149\u5F3A\u5EA6"}),(0,n.jsx)(C.Z,{span:16,children:(0,n.jsx)(I.Z,{min:0,max:2,step:.1,value:g.directionalIntensity,onChange:function(d){return p("directionalIntensity",d)}})})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)(W,{level:5,children:[(0,n.jsx)(en.Z,{})," \u573A\u666F\u8BBE\u7F6E"]}),(0,n.jsxs)(P.Z,{align:"middle",gutter:[16,8],children:[(0,n.jsx)(C.Z,{span:8,children:"\u80CC\u666F\u989C\u8272"}),(0,n.jsx)(C.Z,{span:16,children:(0,n.jsx)(Ge.Z,{value:g.backgroundColor,onChange:function(d){return p("backgroundColor",d.toHexString())}})}),(0,n.jsx)(C.Z,{span:8,children:"\u7F51\u683C\u663E\u793A"}),(0,n.jsx)(C.Z,{span:16,children:(0,n.jsx)(Q.Z,{checked:g.showGrid,checkedChildren:"\u5F00\u542F",unCheckedChildren:"\u5173\u95ED",onChange:function(d){return p("showGrid",d)}})}),(0,n.jsx)(C.Z,{span:8,children:"\u9634\u5F71"}),(0,n.jsx)(C.Z,{span:16,children:(0,n.jsx)(Q.Z,{checked:g.shadows,checkedChildren:"\u5F00\u542F",unCheckedChildren:"\u5173\u95ED",onChange:function(d){return p("shadows",d)}})})]})]})]});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(He.Z,{title:"\u573A\u666F\u8BBE\u7F6E",children:(0,n.jsx)(L.ZP,{color:"primary",variant:"text",icon:(0,n.jsx)(nn.Z,{}),onClick:function(){return i(!0)}})}),(0,n.jsx)(We.Z,{title:"\u573A\u666F\u914D\u7F6E",placement:"right",onClose:function(){return i(!1)},open:t,width:400,children:l})]})},an=tn,oe=o(4393),se=o(32983),le=o(50228),rn=o(82061),$=k.Z.Text,on=function(v){var g=v.urdfFiles,p=v.activeUrdfFiles,e=v.onUrdfToggle,a=v.onUrdfDelete,r=v.extra;return(0,n.jsx)(oe.Z,{title:"URDF\u6A21\u578B\u5217\u8868",size:"small",className:"urdf-list-card",extra:r,children:g.length>0?g.map(function(t){var i=p.some(function(l){return l.id===t.id});return(0,n.jsxs)("div",{className:"urdf-list-item ".concat(i?"active":""),children:[(0,n.jsxs)("div",{className:"urdf-list-item-content",children:[(0,n.jsx)(le.Z,{className:"robot-icon ".concat(i?"active":"")}),(0,n.jsx)($,{style:{flex:1},children:t.name})]}),(0,n.jsxs)(N.Z,{children:[(0,n.jsx)(Q.Z,{size:"small",checked:i,onChange:function(s){return e(t,s)}}),(0,n.jsx)(L.ZP,{type:"text",size:"small",danger:!0,icon:(0,n.jsx)(rn.Z,{}),onClick:function(){return a(t)}})]})]},t.id)}):(0,n.jsx)(se.Z,{image:se.Z.PRESENTED_IMAGE_SIMPLE,description:(0,n.jsxs)(N.Z,{direction:"vertical",align:"center",size:4,children:[(0,n.jsx)($,{type:"secondary",children:"\u6682\u65E0\u6A21\u578B"}),(0,n.jsx)($,{type:"secondary",style:{fontSize:"12px"},children:"\u8BF7\u5148\u4E0A\u4F20 URDF \u6A21\u578B\u6587\u4EF6"})]}),style:{margin:"20px 0",padding:"20px 0",backgroundColor:"#fafafa",borderRadius:"4px"}})})},sn=on,G=o(53025),q=o(13457),ln=o(11665),dn=o(60770),de=o(60801),un=o(47389),ue=k.Z.Text,cn=function(v){var g=v.title,p=v.joints,e=v.position,a=e===void 0?{x:0,y:0,z:0}:e,r=v.rotation,t=r===void 0?{x:0,y:0,z:0}:r,i=v.onJointChange,l=v.onPositionChange,s=v.onRotationChange,d=v.onJointMappingChange,c=(0,w.useState)({}),u=E()(c,2),m=u[0],Z=u[1],M=(0,w.useState)(!1),b=E()(M,2),U=b[0],T=b[1],z=(0,w.useState)(null),_=E()(z,2),y=_[0],R=_[1],ee=G.Z.useForm(),yn=E()(ee,1),ce=yn[0],he=function(x){return D.M8C.radToDeg(x||0)},fe=function(x){Z(x),d==null||d(x)},Zn=function(x){var O=f()(f()({},m),{},h()({},y,x.mappedName));fe(O),T(!1)},Fn=function(){var x=f()({},m);delete x[y],fe(x),T(!1)},Dn=function(){return(0,n.jsx)("div",{className:"controller-section",children:(0,n.jsx)(P.Z,{align:"middle",gutter:[16,8],children:["x","y","z"].map(function(x){return(0,n.jsxs)(w.Fragment,{children:[(0,n.jsx)(C.Z,{span:2,children:x.toUpperCase()}),(0,n.jsx)(C.Z,{span:14,children:(0,n.jsx)(I.Z,{min:-10,max:10,step:.1,value:a[x],onChange:function(F){return l(x,F)}})}),(0,n.jsx)(C.Z,{span:8,children:(0,n.jsx)(q.Z,{min:-10,max:10,style:{width:"100%"},value:a[x],onChange:function(F){return l(x,F)}})})]},x)})})})},bn=function(){return(0,n.jsx)("div",{className:"controller-section",children:(0,n.jsx)(P.Z,{align:"middle",gutter:[16,8],children:["x","y","z"].map(function(x){return(0,n.jsxs)(w.Fragment,{children:[(0,n.jsx)(C.Z,{span:2,children:x.toUpperCase()}),(0,n.jsx)(C.Z,{span:14,children:(0,n.jsx)(I.Z,{min:-180,max:180,step:1,value:he(t[x]),onChange:function(F){return s(x,F)}})}),(0,n.jsx)(C.Z,{span:8,children:(0,n.jsx)(q.Z,{min:-180,max:180,style:{width:"100%"},value:he(t[x]),onChange:function(F){return s(x,F)}})})]},x)})})})},Mn=function(){return Object.entries(p).map(function(x){var O=E()(x,2),F=O[0],B=O[1],ge=m[F]||F;return(0,n.jsxs)("div",{style:{marginBottom:16},children:[(0,n.jsxs)(N.Z,{align:"center",style:{marginBottom:8},children:[(0,n.jsx)(ue,{style:{width:120},ellipsis:{tooltip:F},children:F}),ge!==F&&(0,n.jsxs)(ue,{type:"secondary",style:{fontSize:12},children:["\u2192 ",ge]}),(0,n.jsx)(L.ZP,{type:"link",size:"small",icon:(0,n.jsx)(un.Z,{}),onClick:function(){R(F),ce.setFieldsValue({mappedName:m[F]||""}),T(!0)}})]}),(0,n.jsxs)(P.Z,{align:"middle",gutter:[16,8],children:[(0,n.jsx)(C.Z,{span:16,children:(0,n.jsx)(I.Z,{min:B.limits.lower,max:B.limits.upper,value:B.angle,onChange:function(ne){return i(F,ne)}})}),(0,n.jsx)(C.Z,{span:8,children:(0,n.jsx)(q.Z,{size:"small",style:{width:"100%"},min:B.limits.lower,max:B.limits.upper,value:B.angle,onChange:function(ne){return i(F,ne)}})})]})]},F)})},En=[{key:"position",label:"\u4F4D\u7F6E",children:Dn()},{key:"rotation",label:"\u65CB\u8F6C",children:bn()},{key:"joints",label:"\u5173\u8282",children:Mn()}];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(oe.Z,{title:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(le.Z,{}),"\u2002",g]}),size:"small",children:(0,n.jsx)(ln.Z,{style:{marginLeft:-16},size:"small",defaultActiveKey:"position",items:En,tabPosition:"left"})}),(0,n.jsx)(dn.Z,{title:"\u7F16\u8F91\u5173\u8282\u6620\u5C04",open:U,onCancel:function(){return T(!1)},footer:null,children:(0,n.jsxs)(G.Z,{form:ce,onFinish:Zn,children:[(0,n.jsx)(G.Z.Item,{label:"\u539F\u59CB\u5173\u8282\u540D",children:(0,n.jsx)(de.Z,{disabled:!0,value:y})}),(0,n.jsx)(G.Z.Item,{name:"mappedName",label:"\u6620\u5C04\u5173\u8282\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6620\u5C04\u5173\u8282\u540D"}],children:(0,n.jsx)(de.Z,{placeholder:"\u4F8B\u5982: left_thumb_CMC"})}),(0,n.jsx)(G.Z.Item,{children:(0,n.jsxs)(N.Z,{children:[(0,n.jsx)(L.ZP,{type:"primary",htmlType:"submit",children:"\u786E\u5B9A"}),m[y]&&(0,n.jsx)(L.ZP,{danger:!0,onClick:Fn,children:"\u5220\u9664\u6620\u5C04"})]})})]})})]})},hn=cn,fn=function(v){return new Promise(function(g,p){var e=new FileReader;e.onload=function(){return g(e.result)},e.onerror=function(){return p(e.error)};var a=v.name.toLowerCase();a.endsWith(".stl")?e.readAsArrayBuffer(v):e.readAsText(v)})},gn=fn,mn=o(48476),vn=function(){function S(v){var g=this;ae()(this,S),h()(this,"urdfRender",void 0),h()(this,"handleMessage",function(){var p=H()(A()().mark(function e(a){var r,t,i,l,s,d;return A()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:r=a.data,t=r.type,i=r.data,l=r.requestId,u.prev=2,u.t0=t,u.next=u.t0==="LOAD_MODEL"?6:u.t0==="UPDATE_JOINT"?10:u.t0==="SET_VIEW"?15:u.t0==="GET_JOINTS"?17:u.t0==="RESET_SCENE"?19:21;break;case 6:return u.next=8,g.urdfRender.handleModelLoad(i);case 8:return s=u.sent,u.abrupt("break",21);case 10:return d=i,u.next=13,g.urdfRender.handleJointChange(d.robotId,d.jointName,d.angle);case 13:return s={success:!0,jointName:d.jointName,angle:d.angle},u.abrupt("break",21);case 15:return s=g.urdfRender.handleViewChange(i.view),u.abrupt("break",21);case 17:return s=g.urdfRender.getJointsInfo(),u.abrupt("break",21);case 19:return s=g.urdfRender.resetScene(),u.abrupt("break",21);case 21:s&&g.sendResponse(a.source,{type:"".concat(t,"_RESPONSE"),data:s,requestId:l}),u.next=27;break;case 24:u.prev=24,u.t1=u.catch(2),g.sendResponse(a.source,{type:"ERROR",data:{message:u.t1.message,jointName:i==null?void 0:i.jointName},requestId:l});case 27:case"end":return u.stop()}},e,null,[[2,24]])}));return function(e){return p.apply(this,arguments)}}()),this.urdfRender=v,this.initMessageListener()}return re()(S,[{key:"initMessageListener",value:function(){window.addEventListener("message",this.handleMessage)}},{key:"sendResponse",value:function(g,p){g.postMessage(p,"*")}},{key:"destroy",value:function(){window.removeEventListener("message",this.handleMessage)}}]),S}(),pn=function(S){Ee()(g,S);var v=Le()(g);function g(p){var e;return ae()(this,g),e=v.call(this,p),h()(j()(e),"initLoader",function(){var a=new D.lLk;e.loader=new Te.Z(a),e.loader.loadMeshCb=e.handleMeshLoad}),h()(j()(e),"handleMeshLoad",function(a,r,t){var i=a.split("/").at(-1),l=e.currentLoadingRobotId,s=e.fileMap.get(l),d=(s==null?void 0:s.get(i))||a,c=a.split(".").pop().toLowerCase(),u;c==="stl"?(u=new mn.j(r),u.load(d,function(m){var Z=new D.xoR,M=new D.Kj0(m,Z),b=new D.xsS;b.add(M),t(b)},void 0,function(m){console.error("\u52A0\u8F7D\u9519\u8BEF:",m),t(null,m)})):(u=new Ae.G(r),u.load(d,function(m){t(m.scene)},void 0,function(m){console.error("\u52A0\u8F7D\u9519\u8BEF:",m),t(null,m)}))}),h()(j()(e),"cleanupThreeJS",function(){e.animationFrameId&&cancelAnimationFrame(e.animationFrameId),e.resizeObserver&&e.resizeObserver.disconnect(),e.controls&&e.controls.dispose(),e.renderer&&(e.renderer.dispose(),e.mount.removeChild(e.renderer.domElement)),e.scene&&e.scene.traverse(function(a){a.geometry&&a.geometry.dispose(),a.material&&(Array.isArray(a.material)?a.material.forEach(function(r){return r.dispose()}):a.material.dispose())}),e.fileMap.forEach(function(a){a.forEach(function(r){typeof r=="string"&&r.startsWith("blob:")&&URL.revokeObjectURL(r)})}),e.fileMap.clear(),e.scene=null,e.camera=null,e.renderer=null,e.controls=null,e.loader=null,e.grid=null,e.ambientLight=null,e.directionalLight=null}),h()(j()(e),"handleModelLoad",function(){var a=H()(A()().mark(function r(t,i){return A()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:e.setState(function(d){var c=t.map(function(Z){return f()(f()({},Z),{},{id:Z.id||"robot-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),meshFiles:i})}),u=new Set(d.urdfFiles.map(function(Z){return Z.name})),m=c.filter(function(Z){return!u.has(Z.name)});return{urdfFiles:[].concat(X()(d.urdfFiles),X()(m))}});case 1:case"end":return s.stop()}},r)}));return function(r,t){return a.apply(this,arguments)}}()),h()(j()(e),"handleUrdfToggle",function(){var a=H()(A()().mark(function r(t,i){var l,s,d,c,u,m,Z,M,b,U,T,z;return A()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!i){y.next=25;break}if(y.prev=1,e.currentLoadingRobotId=t.id,!e.fileMap.has(t.id)){if(l=new Map,t.meshFiles){s=Ce()(t.meshFiles);try{for(s.s();!(d=s.n()).done;)c=E()(d.value,2),u=c[0],m=c[1],Z=URL.createObjectURL(m),l.set(u,Z)}catch(R){s.e(R)}finally{s.f()}}e.fileMap.set(t.id,l)}return y.next=6,gn(t.file);case 6:M=y.sent,b=e.loader.parse(M),U=e.initializeJoints(b),b.position.set(0,0,0),b.rotation.set(0,0,0),e.scene.add(b),e.setState(function(R){return{activeUrdfFiles:[].concat(X()(R.activeUrdfFiles),[t]),robotsData:f()(f()({},R.robotsData),{},h()({},t.id,{robot:b,joints:U,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}}))}}),window.parent.postMessage({type:"ROBOT_LOADED",data:{robotId:t.id,name:t.name,joints:Object.keys(U)}},"*"),y.next=20;break;case 16:y.prev=16,y.t0=y.catch(1),console.error("Error in handleUrdfToggle:",y.t0),K.ZP.error("\u52A0\u8F7DURDF\u6587\u4EF6 ".concat(t.name," \u5931\u8D25"));case 20:return y.prev=20,e.currentLoadingRobotId=null,y.finish(20);case 23:y.next=31;break;case 25:T=e.fileMap.get(t.id),T&&T.forEach(function(R){typeof R=="string"&&R.startsWith("blob:")&&URL.revokeObjectURL(R)}),e.fileMap.delete(t.id),z=e.state.robotsData[t.id],z&&z.robot&&e.scene.remove(z.robot),e.setState(function(R){return{activeUrdfFiles:R.activeUrdfFiles.filter(function(ee){return ee.id!==t.id}),robotsData:f()(f()({},R.robotsData),{},h()({},t.id,void 0))}});case 31:case"end":return y.stop()}},r,null,[[1,16,20,23]])}));return function(r,t){return a.apply(this,arguments)}}()),h()(j()(e),"handleJointChange",function(a,r,t){var i=e.state.robotsData[a];if(!i)throw new Error("Robot ".concat(a," not found"));var l=i.joints[r];if(!l){var s=Object.entries(i.jointMappings||{}).find(function(u){var m=E()(u,2),Z=m[0],M=m[1];return M===r});s&&(l=i.joints[s[0]])}if(!l)throw new Error("Joint ".concat(r," not found"));if(t<l.limits.lower||t>l.limits.upper)throw new Error("Joint ".concat(r," angle out of limits"));if(l.angle=t,i.robot)try{i.robot.setJointValue(r,t)}catch(u){var d;console.warn("Failed to update joint with name ".concat(r,", trying mapped name"));var c=(d=i.jointMappings)===null||d===void 0?void 0:d[r];c&&i.robot.setJointValue(c,t)}e.setState(function(u){return{robotsData:f()(f()({},u.robotsData),{},h()({},a,i))}})}),h()(j()(e),"handleJointUpdate",function(a){e.scene&&a.forEach(function(r){var t=r.jointName,i=r.angle;Object.entries(e.state.robotsData).forEach(function(l){var s=E()(l,2),d=s[0],c=s[1];if(!(!c||!c.robot))try{var u=!1;if(c.joints[t]&&(c.robot.setJointValue(t,i),c.joints[t].angle=i,u=!0),!u&&c.jointMappings){var m=c.jointMappings[t];m&&c.joints[m]&&(c.robot.setJointValue(m,i),c.joints[m].angle=i,u=!0)}if(!u){var Z=Object.entries(c.jointMappings||{}).filter(function(M){var b=E()(M,2),U=b[0],T=b[1];return T===t});Z.forEach(function(M){var b=E()(M,1),U=b[0];c.joints[U]&&(c.robot.setJointValue(U,i),c.joints[U].angle=i,u=!0)})}u&&(e.setState(function(M){return{robotsData:f()(f()({},M.robotsData),{},h()({},d,f()(f()({},c),{},{joints:f()({},c.joints)})))}}),e.renderer&&e.scene&&e.camera&&e.renderer.render(e.scene,e.camera))}catch(M){console.warn("Failed to update joint ".concat(t," for robot ").concat(d,":"),M.message)}})})}),h()(j()(e),"handlePositionChange",function(a,r,t){var i=e.state.robotsData[a];i&&i.robot&&t!==null&&t!==void 0&&(i.robot.position[r]=t,e.setState(function(l){return{robotsData:f()(f()({},l.robotsData),{},h()({},a,f()(f()({},i),{},{position:f()(f()({},i.position),{},h()({},r,t))})))}}))}),h()(j()(e),"handleRotationChange",function(a,r,t){var i=e.state.robotsData[a];if(i&&i.robot&&t!==null&&t!==void 0){var l=D.M8C.degToRad(t);i.robot.rotation[r]=l,e.setState(function(s){return{robotsData:f()(f()({},s.robotsData),{},h()({},a,f()(f()({},i),{},{rotation:f()(f()({},i.rotation),{},h()({},r,l))})))}})}}),h()(j()(e),"animate",function(){e.controls&&e.controls.update(),e.renderer&&e.scene&&e.camera&&e.renderer.render(e.scene,e.camera),e.animationFrameId=requestAnimationFrame(e.animate)}),h()(j()(e),"initScene",function(){e.scene=new D.xsS,e.scene.background=new D.Ilk(e.state.sceneConfig.backgroundColor),e.state.sceneConfig.showGrid&&(e.grid=new D.VLJ(10,10,8947848,4473924),e.grid.material.opacity=.5,e.grid.material.transparent=!0,e.scene.add(e.grid))}),h()(j()(e),"initCamera",function(){var a=e.state.sceneConfig,r=a.fov,t=a.cameraDistance,i=e.mount.clientWidth/e.mount.clientHeight;e.camera=new D.cPb(r,i,.1,1e3),e.camera.position.set(t*.7,t*.7,t*.7),e.camera.lookAt(0,0,0)}),h()(j()(e),"initRenderer",function(){e.renderer=new we.CP7({antialias:!0,alpha:!0,powerPreference:"high-performance"}),e.renderer.setPixelRatio(window.devicePixelRatio),e.renderer.setSize(e.mount.clientWidth,e.mount.clientHeight,!1),e.renderer.shadowMap.enabled=e.state.sceneConfig.shadows,e.renderer.shadowMap.type=D.ntZ,e.mount.appendChild(e.renderer.domElement);var a=e.renderer.domElement;a.style.width="100%",a.style.height="100%",a.style.display="block"}),h()(j()(e),"initLights",function(){e.ambientLight=new D.Mig(16777215,e.state.sceneConfig.ambientIntensity),e.scene.add(e.ambientLight),e.directionalLight=new D.Ox3(16777215,e.state.sceneConfig.directionalIntensity),e.directionalLight.position.set(5,5,5),e.directionalLight.castShadow=e.state.sceneConfig.shadows,e.state.sceneConfig.shadows&&(e.directionalLight.shadow.mapSize.width=1024,e.directionalLight.shadow.mapSize.height=1024,e.directionalLight.shadow.camera.near=.5,e.directionalLight.shadow.camera.far=500),e.scene.add(e.directionalLight)}),h()(j()(e),"initControls",function(){e.controls=new Ue.z(e.camera,e.renderer.domElement),e.controls.enableDamping=!0,e.controls.dampingFactor=.05,e.controls.addEventListener("change",e.handleCameraChange)}),h()(j()(e),"initResizeObserver",function(){var a;e.resizeObserver=new ResizeObserver(function(){a&&clearTimeout(a),a=setTimeout(function(){if(e.mount&&e.camera&&e.renderer){var r=e.mount.clientWidth,t=e.mount.clientHeight;e.camera.aspect=r/t,e.camera.updateProjectionMatrix(),e.renderer.setPixelRatio(window.devicePixelRatio),e.renderer.setSize(r,t,!1)}},100)}),e.mount&&e.resizeObserver.observe(e.mount)}),h()(j()(e),"initializeJoints",function(a){var r={};return Object.entries(a.joints).forEach(function(t){var i=E()(t,2),l=i[0],s=i[1];if(s.type!=="fixed"){var d,c,u,m;r[l]={name:l,type:s.type,angle:0,limits:{lower:D.M8C.radToDeg((d=(c=s.limit)===null||c===void 0?void 0:c.lower)!==null&&d!==void 0?d:-Math.PI),upper:D.M8C.radToDeg((u=(m=s.limit)===null||m===void 0?void 0:m.upper)!==null&&u!==void 0?u:Math.PI)}}}}),r}),h()(j()(e),"handleConfigChange",function(a,r){e.setState(function(t){return{sceneConfig:f()(f()({},t.sceneConfig),{},h()({},a,r))}},function(){e.updateSceneConfig()})}),h()(j()(e),"updateSceneConfig",function(){var a=e.state.sceneConfig;e.camera.fov=a.fov,e.camera.updateProjectionMatrix(),e.ambientLight&&(e.ambientLight.intensity=a.ambientIntensity),e.directionalLight&&(e.directionalLight.intensity=a.directionalIntensity),e.scene&&(e.scene.background=new D.Ilk(a.backgroundColor)),e.renderer&&(e.renderer.shadowMap.enabled=a.shadows),e.directionalLight&&(e.directionalLight.castShadow=a.shadows),e.scene&&(e.grid&&(e.scene.remove(e.grid),e.grid.material.dispose(),e.grid.geometry.dispose(),e.grid=null),a.showGrid&&(e.grid=new D.VLJ(10,10,8947848,4473924),e.grid.material.opacity=.5,e.grid.material.transparent=!0,e.scene.add(e.grid)))}),h()(j()(e),"handleViewChange",function(a){var r=e.state.sceneConfig,t=r.cameraDistance;switch(a){case"+x":e.camera.position.set(t,0,0),e.camera.up.set(0,0,1);break;case"-x":e.camera.position.set(-t,0,0),e.camera.up.set(0,0,1);break;case"+y":e.camera.position.set(0,t,0),e.camera.up.set(0,0,1);break;case"-y":e.camera.position.set(0,-t,0),e.camera.up.set(0,0,1);break;case"+z":e.camera.position.set(0,0,t),e.camera.up.set(0,1,0);break;case"-z":e.camera.position.set(0,0,-t),e.camera.up.set(0,1,0);break;default:break}e.camera.lookAt(0,0,0),e.controls.target.set(0,0,0),e.controls.update()}),h()(j()(e),"getJointsInfo",function(){var a=e.state.robotsData;return Object.values(a).map(function(r){return{joints:r.joints,position:r.position,rotation:r.rotation}})}),h()(j()(e),"resetScene",function(){}),h()(j()(e),"handleUrdfDelete",function(a){try{e.state.activeUrdfFiles.find(function(r){return r.id===a.id})&&e.handleUrdfToggle(a,!1),e.setState(function(r){return{urdfFiles:r.urdfFiles.filter(function(t){return t.id!==a.id})}})}catch(r){console.error("Error deleting URDF file:",r),K.ZP.error("\u5220\u9664URDF\u6587\u4EF6 ".concat(a.name," \u5931\u8D25"))}}),h()(j()(e),"handleCameraChange",function(){e.renderer&&e.scene&&e.camera&&e.renderer.render(e.scene,e.camera)}),h()(j()(e),"handleJointMappingChange",function(a,r){e.setState(function(t){return{robotsData:f()(f()({},t.robotsData),{},h()({},a,f()(f()({},t.robotsData[a]),{},{jointMappings:r})))}})}),h()(j()(e),"renderModelControllers",function(){var a=e.state,r=a.activeUrdfFiles,t=a.robotsData;return r.map(function(i){var l=t[i.id]||{};return(0,n.jsx)(hn,{title:i.name,joints:l.joints||{},position:l.position,rotation:l.rotation,onJointChange:function(d,c){e.handleJointChange(i.id,d,c)},onPositionChange:function(d,c){return e.handlePositionChange(i.id,d,c)},onRotationChange:function(d,c){return e.handleRotationChange(i.id,d,c)},onJointMappingChange:function(d){return e.handleJointMappingChange(i.id,d)}},i.id)})}),e.state={urdfFiles:[],activeUrdfFiles:[],robotsData:{},sceneConfig:{fov:75,cameraDistance:10,ambientIntensity:.5,directionalIntensity:1,backgroundColor:"#cccccc",showGrid:!0,shadows:!0},jointMappings:{}},e.scene=null,e.camera=null,e.renderer=null,e.controls=null,e.mount=null,e.resizeObserver=null,e.animationFrameId=null,e.ambientLight=null,e.directionalLight=null,e.initLoader(),e.fileMap=new Map,e}return re()(g,[{key:"componentDidMount",value:function(){var e=this;this.initScene(),this.initCamera(),this.initRenderer(),this.initLights(),this.initControls(),this.initResizeObserver(),this.animate(),this.messageHandler=new vn(this),this.handleMessage=function(a){var r=a.data;console.log("URDFRender received message:",r),r.type==="UPDATE_JOINT"?e.handleJointUpdate(r.data):r.type==="UPDATE_JOINT_MAPPING"&&e.setState(function(t){return{jointMappings:f()(f()({},t.jointMappings),r.data)}})},window.addEventListener("message",this.handleMessage)}},{key:"componentWillUnmount",value:function(){this.cleanupThreeJS(),this.messageHandler&&this.messageHandler.destroy(),window.removeEventListener("message",this.handleMessage)}},{key:"render",value:function(){var e=this,a=this.state,r=a.urdfFiles,t=a.activeUrdfFiles,i=a.robotsData,l=a.sceneConfig;return(0,n.jsx)("div",{style:{height:"100vh"},children:(0,n.jsxs)(Y.Z,{children:[(0,n.jsx)(Y.Z.Panel,{defaultSize:"70%",min:"50%",max:"100%",children:(0,n.jsx)("div",{ref:function(d){return e.mount=d},style:{width:"100%",height:"100%",overflow:"hidden"}})}),(0,n.jsx)(Y.Z.Panel,{collapsible:!0,children:(0,n.jsxs)("div",{className:"right-panel",children:[(0,n.jsx)("div",{style:{height:424,paddingTop:8},children:(0,n.jsx)(ke,{onChange:this.handleModelLoad})}),(0,n.jsxs)(N.Z,{direction:"vertical",style:{width:"100%"},children:[(0,n.jsx)(sn,{urdfFiles:r,activeUrdfFiles:t,onUrdfToggle:this.handleUrdfToggle,onUrdfDelete:this.handleUrdfDelete,extra:(0,n.jsx)(an,{config:l,onConfigChange:this.handleConfigChange,onViewChange:this.handleViewChange})}),this.renderModelControllers()]})]})})]})})}}]),g}(w.Component),Cn=pn,jn=function(){var v=(0,w.useState)({}),g=E()(v,2),p=g[0],e=g[1];return(0,w.useEffect)(function(){var a=function(t){var i=t.data;i.type==="UPDATE_JOINT"&&i.data.forEach(function(l){var s=p[l.jointName]||l.jointName})};return window.addEventListener("message",a),function(){return window.removeEventListener("message",a)}},[p]),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(Cn,{})})},xn=jn}}]);
