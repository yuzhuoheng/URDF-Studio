"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[890],{40229:function(Oe,P,t){t.r(P),t.d(P,{default:function(){return Ze}});var H=t(15009),A=t.n(H),K=t(99289),w=t.n(K),Q=t(9783),X=t.n(Q),Y=t(97857),J=t.n(Y),q=t(5574),S=t.n(q),l=t(67294),C=t(4393),B=t(32983),T=t(78957),U=t(40056),R=t(83622),N=t(25409),_=t(50228),b=t(29158),ee=t(35312),ne=t(12444),te=t.n(ne),se=t(72004),ie=t.n(se),oe=function(){function h(){te()(this,h),this.ws=null,this.onMessageReceive=null,this.onTopicsUpdate=null,this.connected=!1}return ie()(h,[{key:"connect",value:function(n){var s=this;return new Promise(function(r,a){try{s.ws=new WebSocket(n),s.ws.onopen=function(){console.log("Connected to ROSBridge"),s.connected=!0,s.ws.send(JSON.stringify({op:"call_service",service:"/rosapi/topics_and_raw_types",args:[]})),r()},s.ws.onclose=function(o){console.log("Disconnected:",o.code,o.reason),s.connected=!1,s.onTopicsUpdate&&s.onTopicsUpdate([])},s.ws.onerror=function(o){console.error("WebSocket error:",o),a(new Error("\u8FDE\u63A5\u5931\u8D25"))},s.ws.onmessage=function(o){try{var u=JSON.parse(o.data);s.handleMessage(u)}catch(c){console.error("Failed to parse message:",c)}}}catch(o){a(o)}})}},{key:"disconnect",value:function(){this.ws&&(this.ws.close(),this.ws=null,this.connected=!1)}},{key:"subscribe",value:function(n){this.connected&&(this.ws.send(JSON.stringify({op:"call_service",service:"/rosapi/topic_type",args:{topic:n}})),this.ws.send(JSON.stringify({op:"subscribe",topic:n,type:"sensor_msgs/msg/JointState"})))}},{key:"unsubscribe",value:function(n){this.connected&&this.ws.send(JSON.stringify({op:"unsubscribe",topic:n}))}},{key:"handleMessage",value:function(n){switch(n.op){case"service_response":if(n.service==="/rosapi/topics_and_raw_types"){var s=n.values.topics.map(function(a,o){return{name:a,type:n.values.types[o]}});this.onTopicsUpdate&&this.onTopicsUpdate(s)}break;case"publish":if(this.onMessageReceive){var r={position:n.msg.position,velocity:n.msg.velocity,effort:n.msg.effort,name:n.msg.name,timestamp:new Date().toISOString()};this.onMessageReceive(n.topic,r)}break;default:console.log("Unhandled message type:",n.op)}}},{key:"requestTopics",value:function(){this.connected&&this.ws.send(JSON.stringify({op:"call_service",service:"/rosapi/topics_and_raw_types",args:[]}))}},{key:"getTopics",value:function(){var n=this;return new Promise(function(s,r){if(!n.connected){r(new Error("\u672A\u8FDE\u63A5\u5230 ROS"));return}var a=function(j){c(),s(j)},o=setTimeout(function(){c(),r(new Error("\u83B7\u53D6\u8BDD\u9898\u5217\u8868\u8D85\u65F6"))},5e3),u=n.onTopicsUpdate,c=function(){clearTimeout(o),n.onTopicsUpdate=u};n.onTopicsUpdate=a,n.ws.send(JSON.stringify({op:"call_service",service:"/rosapi/topics_and_raw_types",args:[]}))})}}]),h}(),re=new oe,m=re,D=t(53025),z=t(2453),ae=t(60801),ce=t(29141),e=t(85893),le=function(i){var n=i.connected,s=i.onConnect,r=i.onDisconnect,a=(0,l.useState)(!1),o=S()(a,2),u=o[0],c=o[1],p=D.Z.useForm(),j=S()(p,1),Z=j[0],F=function(){var E=w()(A()().mark(function x(g){return A()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return c(!0),f.prev=1,f.next=4,s(g.url);case 4:z.ZP.success("\u8FDE\u63A5\u6210\u529F"),f.next=11;break;case 7:f.prev=7,f.t0=f.catch(1),console.error("Connection failed:",f.t0),z.ZP.error("\u8FDE\u63A5\u5931\u8D25: "+f.t0.message);case 11:return f.prev=11,c(!1),f.finish(11);case 14:case"end":return f.stop()}},x,null,[[1,7,11,14]])}));return function(g){return E.apply(this,arguments)}}();return(0,e.jsx)(C.Z,{title:"ROS \u8FDE\u63A5\u8BBE\u7F6E",className:"connection-card",size:"small",children:(0,e.jsxs)(D.Z,{form:Z,layout:"inline",onFinish:F,initialValues:{url:"ws://192.168.8.157:9001"},children:[(0,e.jsx)(D.Z.Item,{name:"url",label:"ROS bridge",rules:[{required:!0,message:"\u8BF7\u8F93\u5165 WebSocket \u5730\u5740"}],children:(0,e.jsx)(ae.Z,{style:{width:240}})}),(0,e.jsx)(D.Z.Item,{children:(0,e.jsxs)(T.Z,{children:[(0,e.jsx)(R.ZP,{type:"primary",htmlType:"submit",loading:u,disabled:n,icon:(0,e.jsx)(b.Z,{}),children:"\u8FDE\u63A5"}),(0,e.jsx)(R.ZP,{onClick:r,disabled:!n,icon:(0,e.jsx)(ce.Z,{}),children:"\u65AD\u5F00\u8FDE\u63A5"})]})})]})})},ue=le,de=t(19632),fe=t.n(de),ve=t(83062),pe=t(66309),he=t(84567),I=t(84496),me=t(33160),Me=function(i){return i?JSON.stringify(i,null,2):"No messages received"},V=function(i){return i==="sensor_msgs/msg/JointState"},ge=function(i){return!i||!i.name?[]:i.name.map(function(n,s){var r,a,o;return{key:n,name:n,position:((r=i.position)===null||r===void 0||(r=r[s])===null||r===void 0?void 0:r.toFixed(3))||"N/A",velocity:((a=i.velocity)===null||a===void 0||(a=a[s])===null||a===void 0?void 0:a.toFixed(3))||"N/A",effort:((o=i.effort)===null||o===void 0||(o=o[s])===null||o===void 0?void 0:o.toFixed(3))||"N/A"}})},ye=function(i){var n=i.topics,s=i.selectedTopics,r=i.onTopicSelect,a=i.onRefresh,o=(0,l.useMemo)(function(){return[{title:"Topic",dataIndex:"name",key:"name",width:"30%",ellipsis:!0,render:function(c){return(0,e.jsx)(ve.Z,{title:c,children:(0,e.jsx)("span",{className:"topic-name",children:c})})}},{title:"\u6D88\u606F\u7C7B\u578B",dataIndex:"type",key:"type",render:function(c){return(0,e.jsx)(pe.Z,{color:V(c)?"blue":"default",children:c})},filters:[{text:"\u5173\u8282\u72B6\u6001",value:"sensor_msgs/msg/JointState"}],onFilter:function(c,p){return p.type===c}},{title:"\u8BA2\u9605",key:"subscribe",width:80,render:function(c,p){var j=s.includes(p.name),Z=V(p.type);return(0,e.jsx)(he.Z,{checked:j,disabled:!Z,onChange:function(E){E.target.checked?r([].concat(fe()(s),[p.name])):r(s.filter(function(x){return x!==p.name}))},children:"\u8BA2\u9605"})}}]},[s,r]);return(0,e.jsxs)(C.Z,{size:"small",className:"topic-list",children:[(0,e.jsx)(R.ZP,{color:"primary",variant:"filled",size:"small",style:{float:"right",marginBottom:"4px"},icon:(0,e.jsx)(me.Z,{}),onClick:a,children:"\u5237\u65B0"}),(0,e.jsx)(I.Z,{columns:o,dataSource:n,rowKey:"name",size:"small",pagination:{pageSize:10,size:"small",showSizeChanger:!1,showQuickJumper:!1}})]})},Se=l.memo(ye),je=function(i){var n=i.messages,s=i.selectedTopics;if(s.length===0)return(0,e.jsx)(B.Z,{description:"\u6682\u672A\u9009\u62E9\u4EFB\u4F55\u8BDD\u9898",image:B.Z.PRESENTED_IMAGE_SIMPLE});var r=[{title:"\u5173\u8282\u540D\u79F0",dataIndex:"name",key:"name"},{title:"\u4F4D\u7F6E",dataIndex:"position",key:"position"},{title:"\u901F\u5EA6",dataIndex:"velocity",key:"velocity"},{title:"\u529B\u77E9",dataIndex:"effort",key:"effort"}];return(0,e.jsx)(T.Z,{direction:"vertical",style:{width:"100%"},size:"middle",children:s.map(function(a){var o=n[a];if(!o)return null;var u=ge(o);return(0,e.jsx)(C.Z,{title:(0,e.jsx)("span",{className:"topic-name",children:a}),size:"small",className:"message-viewer",extra:(0,e.jsxs)("span",{children:["\u6700\u540E\u66F4\u65B0: ",o.timestamp]}),children:(0,e.jsx)(I.Z,{columns:r,dataSource:u,size:"small",pagination:!1})},a)})})},xe=l.memo(je),Fe=function(i){var n=i.jointStates,s=(0,l.useRef)(null);return(0,l.useEffect)(function(){if(n&&n.name&&Array.isArray(n.name)){var r,a=n.name.map(function(o,u){return{jointName:o,angle:Array.isArray(n.position)&&n.position[u]||0}});(r=s.current)===null||r===void 0||r.contentWindow.postMessage({type:"UPDATE_JOINT",data:a},"*")}},[n]),(0,e.jsx)("iframe",{ref:s,src:"/urdf/online",style:{width:"100%",height:"100%",minHeight:"calc(100vh - 240px)",border:"none",borderRadius:"4px",backgroundColor:"#f0f2f5"},title:"URDF Viewer"})},Ce=l.memo(Fe),Te=function(){var i=(0,l.useState)(!1),n=S()(i,2),s=n[0],r=n[1],a=(0,l.useState)(null),o=S()(a,2),u=o[0],c=o[1],p=(0,l.useState)([]),j=S()(p,2),Z=j[0],F=j[1],E=(0,l.useState)([]),x=S()(E,2),g=x[0],O=x[1],f=(0,l.useState)({}),k=S()(f,2),Ee=k[0],L=k[1],Ae=(0,l.useState)(null),$=S()(Ae,2),Re=$[0],W=$[1];(0,l.useEffect)(function(){return m.onMessageReceive=function(y,d){L(function(M){return J()(J()({},M),{},X()({},y,d))}),d.name&&Array.isArray(d.position)&&W({name:d.name,position:d.position,timestamp:d.timestamp})},m.onTopicsUpdate=F,function(){m.disconnect(),m.onMessageReceive=null,m.onTopicsUpdate=null}},[]);var De=(0,l.useCallback)(function(y){g.forEach(function(d){y.includes(d)||m.unsubscribe(d)}),y.forEach(function(d){g.includes(d)||m.subscribe(d)}),O(y)},[g]),Be=(0,l.useCallback)(function(){var y=w()(A()().mark(function d(M){var G;return A()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.prev=0,c(null),v.next=4,m.connect(M);case 4:return r(!0),v.next=7,m.getTopics();case 7:G=v.sent,F(G),v.next=16;break;case 11:throw v.prev=11,v.t0=v.catch(0),c(v.t0.message),r(!1),v.t0;case 16:case"end":return v.stop()}},d,null,[[0,11]])}));return function(d){return y.apply(this,arguments)}}(),[]),Ne=function(){return(0,e.jsx)(C.Z,{children:(0,e.jsx)(B.Z,{image:(0,e.jsx)(_.Z,{style:{fontSize:64,color:"#1890ff"}}),description:(0,e.jsxs)(T.Z,{direction:"vertical",size:"large",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{children:"ROS \u4EFF\u771F\u63A7\u5236\u53F0"}),(0,e.jsx)("p",{children:"\u8FDE\u63A5\u5230 ROS Bridge \u4EE5\u5F00\u59CB\u4EFF\u771F\u8C03\u8BD5"})]}),u&&(0,e.jsx)(U.Z,{type:"error",message:"\u8FDE\u63A5\u5931\u8D25",description:u,showIcon:!0}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:"\u529F\u80FD\u8BF4\u660E\uFF1A"}),(0,e.jsxs)("ul",{style:{textAlign:"left"},children:[(0,e.jsx)("li",{children:"1. \u8FDE\u63A5 ROS Bridge"}),(0,e.jsx)("li",{children:"2. \u8BA2\u9605 joint_states Topic \u8FDB\u884C\u5173\u8282\u63A7\u5236"}),(0,e.jsx)("li",{children:"3. \u5B9E\u65F6\u9884\u89C8\u673A\u5668\u4EBA\u72B6\u6001"}),(0,e.jsx)("li",{children:"4. \u652F\u6301\u5173\u8282\u540D\u79F0\u6620\u5C04"})]})]}),(0,e.jsx)(U.Z,{type:"info",message:(0,e.jsxs)(T.Z,{children:["\u5982\u679C\u53EA\u9700\u8981\u9884\u89C8 URDF \u6A21\u578B\uFF0C\u8BF7\u8BBF\u95EE",(0,e.jsx)(R.ZP,{type:"link",icon:(0,e.jsx)(b.Z,{}),onClick:function(){return ee.history.push("/online")},children:"\u6A21\u578B\u9884\u89C8\u9875\u9762"})]})})]})})})};return(0,e.jsx)("div",{className:"ros-page",children:(0,e.jsxs)(T.Z,{direction:"vertical",style:{width:"100%"},size:"middle",children:[(0,e.jsx)(ue,{connected:s,onConnect:Be,onDisconnect:function(){m.disconnect(),r(!1),F([]),O([]),L({}),W(null)}}),s?(0,e.jsxs)(N.Z,{style:{height:"calc(100vh - 120px)"},children:[(0,e.jsxs)(N.Z.Panel,{defaultSize:"30%",collapsible:!0,children:[(0,e.jsx)(Se,{topics:Z,selectedTopics:g,onTopicSelect:De}),g.length>0&&(0,e.jsx)(C.Z,{className:"content-card",style:{marginTop:16},children:(0,e.jsx)(xe,{messages:Ee,selectedTopics:g})})]}),(0,e.jsx)(N.Z.Panel,{children:(0,e.jsx)(Ce,{jointStates:Re})})]}):Ne()]})})},Ze=Te}}]);
